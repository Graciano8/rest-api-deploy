<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <style>
            main{
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }
            article{
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
                border: 1px solid #ccc;
                padding: 5px 5px;
                margin: 5px;
                border-radius: 5px;
                width: 500px;
            }
            article img {
                width: 200px;
            }
        </style>
        <script type="module">
            fetch("http://localhost:3000/movies")
                .then(res => res.json())
                .then(movies => {
                    const html = movies.map(movie => {
                        return `
                        <article data-id="${movie.id}">
                        <h2>${movie.title}</h2>
                        <img src="${movie.poster}" alt="${movie.title}">
                        <p>${movie.year}</p>

                        <button>Eliminar</button>
                        </article>`;
                    }).join("")

                    document.querySelector("main").innerHTML = html;

                    document.addEventListener("click", e => {
                        if (e.target.matches("button")) {
                            const article = e.target.closest("article");
                            const id = article.dataset.id;

                            fetch(`http://localhost:3000/movies/${id}`, {
                                method: "DELETE"
                            })
                              .then(res  => {
                                  if (res.ok) {
                                      article.remove();
                                  }
                              })
                        }
                    })
                })
        </script>
    </head>
    <body>
        <h1>Consumiento mi API</h1>
        <main></main>
    </body>
</html>